{% extends "base.html" %} {% block title %}Anime - StreamFlix{% endblock %} 
{% block content %}
<div class="container mx-auto px-4 py-24">
  <h1 class="text-3xl font-bold mb-8">
    <i class="fas fa-film text-red-600 mr-2"></i>All Animes
  </h1>

  <!-- Filters -->
  <div class="flex flex-wrap gap-4 mb-8">
    <select
      id="sortBy"
      class="bg-gray-800 text-white px-4 py-2 rounded-lg border border-gray-700">
      <option value="new">Newest First</option>
      <option value="year">Year</option>
      <option value="name">Name</option>
    </select>

    <select
      id="yearFilter"
      class="bg-gray-800 text-white px-4 py-2 rounded-lg border border-gray-700">
      <option value="">All Years</option>
      <option value="2025">2025</option>
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
    </select>
  </div>

  <!-- Movies Grid -->
  <div
    id="moviesGrid"
    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
    <!-- Loading Skeletons -->
    <div class="skeleton bg-gray-800 rounded-lg h-80"></div>
    <div class="skeleton bg-gray-800 rounded-lg h-80"></div>
    <div class="skeleton bg-gray-800 rounded-lg h-80"></div>
    <div class="skeleton bg-gray-800 rounded-lg h-80"></div>
    <div class="skeleton bg-gray-800 rounded-lg h-80"></div>
    <div class="skeleton bg-gray-800 rounded-lg h-80"></div>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center items-center space-x-4">
    <button
      id="prevPage"
      class="bg-gray-800 hover:bg-gray-700 px-6 py-3 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
      <i class="fas fa-chevron-left mr-2"></i>Previous
    </button>

    <span id="pageInfo" class="text-gray-400">Page 1</span>

    <button
      id="nextPage"
      class="bg-gray-800 hover:bg-gray-700 px-6 py-3 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
      Next<i class="fas fa-chevron-right ml-2"></i>
    </button>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  const API_BASE = "/api/v1";
  let currentPage = 1;

  async function loadMovies(page = 1) {
    try {
      const response = await fetch(`${API_BASE}/movies/anime?page=${page}`);
      const data = await response.json();

      if (data.success) {
        displayMovies(data.data);
        updatePagination(data.pagination);
      }
    } catch (error) {
      console.error("Error loading movies:", error);
    }
  }

  function displayMovies(movies) {
    const html = movies.map((movie) => createMovieCard(movie)).join("");
    document.getElementById("moviesGrid").innerHTML = html;
  }

  function createMovieCard(movie) {
    const url = `https://phimimg.com/${movie.poster_url || movie.thumb_url}`;
    return `
            <div class="movie-card bg-gray-800 rounded-lg overflow-hidden" onclick="window.location.href='/movie/${
              movie.slug
            }'">
                <div class="relative">
                    <img 
                        src="${url}" 
                        alt="${movie.name}"
                        class="w-full h-80 object-cover"
                        onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'"
                    >
                    <div class="absolute top-2 right-2">
                        <span class="badge bg-red-600 text-white">
                            ${movie.year || "N/A"}
                        </span>
                    </div>
                    ${
                      movie.quality
                        ? `
                        <div class="absolute top-2 left-2">
                            <span class="badge bg-yellow-600 text-white">
                                ${movie.quality}
                            </span>
                        </div>
                    `
                        : ""
                    }
                </div>
                <div class="p-3">
                    <h3 class="font-semibold text-sm truncate">${
                      movie.name
                    }</h3>
                    <p class="text-xs text-gray-400 truncate">${
                      movie.origin_name || ""
                    }</p>
                </div>
            </div>
        `;
  }

  function updatePagination(pagination) {
    currentPage = pagination.currentPage;
    document.getElementById(
      "pageInfo"
    ).textContent = `Page ${currentPage} of ${pagination.totalPages}`;

    document.getElementById("prevPage").disabled = currentPage === 1;
    document.getElementById("nextPage").disabled =
      currentPage >= pagination.totalPages;
  }

  document.getElementById("prevPage").addEventListener("click", () => {
    if (currentPage > 1) {
      loadMovies(currentPage - 1);
      window.scrollTo(0, 0);
    }
  });

  document.getElementById("nextPage").addEventListener("click", () => {
    loadMovies(currentPage + 1);
    window.scrollTo(0, 0);
  });

  document.addEventListener("DOMContentLoaded", () => loadMovies(1));
</script>
{% endblock %}
